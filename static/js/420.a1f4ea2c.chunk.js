"use strict";(self.webpackChunkold_e5=self.webpackChunkold_e5||[]).push([[420],{39420(e,t,n){n.r(t),n.d(t,{AsfParser:()=>L});var a=n(81760),r=n(41124),i=n(36944);class s{static fromBin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new s(s.decode(e,t))}static decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=new DataView(e.buffer,t);return"".concat(n.getUint32(0,!0).toString(16),"-").concat(n.getUint16(4,!0).toString(16),"-").concat(n.getUint16(6,!0).toString(16),"-").concat(n.getUint16(8).toString(16),"-").concat((0,i.EY)(e.slice(t+10,t+16))).toUpperCase()}static decodeMediaType(e){switch(e.str){case s.AudioMedia.str:return"audio";case s.VideoMedia.str:return"video";case s.CommandMedia.str:return"command";case s.Degradable_JPEG_Media.str:return"degradable-jpeg";case s.FileTransferMedia.str:return"file-transfer";case s.BinaryMedia.str:return"binary"}}static encode(e){const t=new Uint8Array(16),n=new DataView(t.buffer);return n.setUint32(0,Number.parseInt(e.slice(0,8),16),!0),n.setUint16(4,Number.parseInt(e.slice(9,13),16),!0),n.setUint16(6,Number.parseInt(e.slice(14,18),16),!0),t.set((0,i.AS)(e.slice(19,23)),8),t.set((0,i.AS)(e.slice(24)),10),t}constructor(e){this.str=e}equals(e){return this.str===e.str}toBin(){return s.encode(this.str)}}s.HeaderObject=new s("75B22630-668E-11CF-A6D9-00AA0062CE6C"),s.DataObject=new s("75B22636-668E-11CF-A6D9-00AA0062CE6C"),s.SimpleIndexObject=new s("33000890-E5B1-11CF-89F4-00A0C90349CB"),s.IndexObject=new s("D6E229D3-35DA-11D1-9034-00A0C90349BE"),s.MediaObjectIndexObject=new s("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C"),s.TimecodeIndexObject=new s("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C"),s.FilePropertiesObject=new s("8CABDCA1-A947-11CF-8EE4-00C00C205365"),s.StreamPropertiesObject=new s("B7DC0791-A9B7-11CF-8EE6-00C00C205365"),s.HeaderExtensionObject=new s("5FBF03B5-A92E-11CF-8EE3-00C00C205365"),s.CodecListObject=new s("86D15240-311D-11D0-A3A4-00A0C90348F6"),s.ScriptCommandObject=new s("1EFB1A30-0B62-11D0-A39B-00A0C90348F6"),s.MarkerObject=new s("F487CD01-A951-11CF-8EE6-00C00C205365"),s.BitrateMutualExclusionObject=new s("D6E229DC-35DA-11D1-9034-00A0C90349BE"),s.ErrorCorrectionObject=new s("75B22635-668E-11CF-A6D9-00AA0062CE6C"),s.ContentDescriptionObject=new s("75B22633-668E-11CF-A6D9-00AA0062CE6C"),s.ExtendedContentDescriptionObject=new s("D2D0A440-E307-11D2-97F0-00A0C95EA850"),s.ContentBrandingObject=new s("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E"),s.StreamBitratePropertiesObject=new s("7BF875CE-468D-11D1-8D82-006097C9A2B2"),s.ContentEncryptionObject=new s("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E"),s.ExtendedContentEncryptionObject=new s("298AE614-2622-4C17-B935-DAE07EE9289C"),s.DigitalSignatureObject=new s("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E"),s.PaddingObject=new s("1806D474-CADF-4509-A4BA-9AABCB96AAE8"),s.ExtendedStreamPropertiesObject=new s("14E6A5CB-C672-4332-8399-A96952065B5A"),s.AdvancedMutualExclusionObject=new s("A08649CF-4775-4670-8A16-6E35357566CD"),s.GroupMutualExclusionObject=new s("D1465A40-5A79-4338-B71B-E36B8FD6C249"),s.StreamPrioritizationObject=new s("D4FED15B-88D3-454F-81F0-ED5C45999E24"),s.BandwidthSharingObject=new s("A69609E6-517B-11D2-B6AF-00C04FD908E9"),s.LanguageListObject=new s("7C4346A9-EFE0-4BFC-B229-393EDE415C85"),s.MetadataObject=new s("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA"),s.MetadataLibraryObject=new s("44231C94-9498-49D1-A141-1D134E457054"),s.IndexParametersObject=new s("D6E229DF-35DA-11D1-9034-00A0C90349BE"),s.MediaObjectIndexParametersObject=new s("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7"),s.TimecodeIndexParametersObject=new s("F55E496D-9797-4B5D-8C8B-604DFE9BFB24"),s.CompatibilityObject=new s("26F18B5D-4584-47EC-9F5F-0E651F0452C9"),s.AdvancedContentEncryptionObject=new s("43058533-6981-49E6-9B74-AD12CB86D58C"),s.AudioMedia=new s("F8699E40-5B4D-11CF-A8FD-00805F5C442B"),s.VideoMedia=new s("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B"),s.CommandMedia=new s("59DACFC0-59E6-11D0-A3AC-00A0C90348F6"),s.JFIF_Media=new s("B61BE100-5B4E-11CF-A8FD-00805F5C442B"),s.Degradable_JPEG_Media=new s("35907DE0-E415-11CF-A917-00805F5C442B"),s.FileTransferMedia=new s("91BD222C-F21C-497A-8B6D-5AA86BFC0185"),s.BinaryMedia=new s("3AFB65E2-47EF-40F2-AC2C-70A90D71D343"),s.ASF_Index_Placeholder_Object=new s("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2");const c=s;var o=n(70124),d=n(12092);function u(e){return d.F6(d.sc(e,"utf-16le"))}const g=[u,l,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 1===b(e,t)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.UINT32_LE.get(e,t)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.UINT64_LE.get(e,t)},b,l];function l(e){return new Uint8Array(e)}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.UINT16_LE.get(e,t)}var C,w=n(56756),D=n(92419);class A extends((0,D.fO)("ASF")){}!function(e){e[e.UnicodeString=0]="UnicodeString",e[e.ByteArray=1]="ByteArray",e[e.Bool=2]="Bool",e[e.DWord=3]="DWord",e[e.QWord=4]="QWord",e[e.Word=5]="Word"}(C||(C={}));const E={len:30,get:(e,t)=>({objectId:c.fromBin(e,t),objectSize:Number(o.UINT64_LE.get(e,t+16)),numberOfHeaderObjects:o.UINT32_LE.get(e,t+24)})},B={len:24,get:(e,t)=>({objectId:c.fromBin(e,t),objectSize:Number(o.UINT64_LE.get(e,t+16))})};class m{constructor(e){this.len=Number(e.objectSize)-B.len}postProcessTag(e,t,n,a){if("WM/Picture"===t)e.push({id:t,value:z.fromBuffer(a)});else{const r=g[n];if(!r)throw new A("unexpected value headerType: ".concat(n));e.push({id:t,value:r(a)})}}}class F extends m{get(e,t){return null}}class f extends m{get(e,t){return{fileId:c.fromBin(e,t),fileSize:o.UINT64_LE.get(e,t+16),creationDate:o.UINT64_LE.get(e,t+24),dataPacketsCount:o.UINT64_LE.get(e,t+32),playDuration:o.UINT64_LE.get(e,t+40),sendDuration:o.UINT64_LE.get(e,t+48),preroll:o.UINT64_LE.get(e,t+56),flags:{broadcast:d.mh(e,t+64,24),seekable:d.mh(e,t+64,25)},minimumDataPacketSize:o.UINT32_LE.get(e,t+68),maximumDataPacketSize:o.UINT32_LE.get(e,t+72),maximumBitrate:o.UINT32_LE.get(e,t+76)}}}f.guid=c.FilePropertiesObject;class j extends m{get(e,t){return{streamType:c.decodeMediaType(c.fromBin(e,t)),errorCorrectionType:c.fromBin(e,t+8)}}}j.guid=c.StreamPropertiesObject;class h{constructor(){this.len=22}get(e,t){const n=new DataView(e.buffer,t);return{reserved1:c.fromBin(e,t),reserved2:n.getUint16(16,!0),extensionDataSize:n.getUint16(18,!0)}}}h.guid=c.HeaderExtensionObject;const p={len:20,get:(e,t)=>({entryCount:new DataView(e.buffer,t).getUint16(16,!0)})};async function I(e){const t=await e.readNumber(o.UINT16_LE);return(await e.readToken(new o.StringType(2*t,"utf-16le"))).replace("\0","")}async function O(e){const t=await e.readToken(p),n=[];for(let a=0;a<t.entryCount;++a)n.push(await k(e));return n}async function T(e){const t=await e.readNumber(o.UINT16_LE),n=new Uint8Array(t);return await e.readBuffer(n),n}async function k(e){const t=await e.readNumber(o.UINT16_LE);return{type:{videoCodec:1===(1&t),audioCodec:2===(2&t)},codecName:await I(e),description:await I(e),information:await T(e)}}class U extends m{get(e,t){const n=[],a=new DataView(e.buffer,t);let r=10;for(let i=0;i<U.contentDescTags.length;++i){const s=a.getUint16(2*i,!0);if(s>0){const a=U.contentDescTags[i],c=r+s;n.push({id:a,value:u(e.slice(t+r,t+c))}),r=c}}return n}}U.guid=c.ContentDescriptionObject,U.contentDescTags=["Title","Author","Copyright","Description","Rating"];class S extends m{get(e,t){const n=[],a=new DataView(e.buffer,t),r=a.getUint16(0,!0);let i=2;for(let s=0;s<r;s+=1){const r=a.getUint16(i,!0);i+=2;const s=u(e.slice(t+i,t+i+r));i+=r;const c=a.getUint16(i,!0);i+=2;const o=a.getUint16(i,!0);i+=2;const d=e.slice(t+i,t+i+o);i+=o,this.postProcessTag(n,s,c,d)}return n}}S.guid=c.ExtendedContentDescriptionObject;class y extends m{get(e,t){const n=new DataView(e.buffer,t);return{startTime:o.UINT64_LE.get(e,t),endTime:o.UINT64_LE.get(e,t+8),dataBitrate:n.getInt32(12,!0),bufferSize:n.getInt32(16,!0),initialBufferFullness:n.getInt32(20,!0),alternateDataBitrate:n.getInt32(24,!0),alternateBufferSize:n.getInt32(28,!0),alternateInitialBufferFullness:n.getInt32(32,!0),maximumObjectSize:n.getInt32(36,!0),flags:{reliableFlag:d.mh(e,t+40,0),seekableFlag:d.mh(e,t+40,1),resendLiveCleanpointsFlag:d.mh(e,t+40,2)},streamNumber:n.getInt16(42,!0),streamLanguageId:n.getInt16(44,!0),averageTimePerFrame:n.getInt32(52,!0),streamNameCount:n.getInt32(54,!0),payloadExtensionSystems:n.getInt32(56,!0),streamNames:[],streamPropertiesObject:null}}}y.guid=c.ExtendedStreamPropertiesObject;class x extends m{get(e,t){const n=[],a=new DataView(e.buffer,t),r=a.getUint16(0,!0);let i=2;for(let s=0;s<r;s+=1){i+=4;const r=a.getUint16(i,!0);i+=2;const s=a.getUint16(i,!0);i+=2;const c=a.getUint32(i,!0);i+=4;const o=u(e.slice(t+i,t+i+r));i+=r;const d=e.slice(t+i,t+i+c);i+=c,this.postProcessTag(n,o,s,d)}return n}}x.guid=c.MetadataObject;class N extends x{}N.guid=c.MetadataLibraryObject;class z{static fromBuffer(e){return new z(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const n=new DataView(e.buffer,t),a=n.getUint8(0),r=n.getInt32(1,!0);let i=5;for(;0!==n.getUint16(i);)i+=2;const s=new o.StringType(i-5,"utf-16le").get(e,5);for(;0!==n.getUint16(i);)i+=2;const c=new o.StringType(i-5,"utf-16le").get(e,5);return{type:w.n5[a],format:s,description:c,size:r,data:e.slice(i+4)}}}var _=n(56067);const P=a("music-metadata:parser:ASF");class L extends _.s{async parse(){const e=await this.tokenizer.readToken(E);if(!e.objectId.equals(c.HeaderObject))throw new A("expected asf header; but was not found; got: ".concat(e.objectId.str));try{await this.parseObjectHeader(e.numberOfHeaderObjects)}catch(t){P("Error while parsing ASF: %s",t)}}async parseObjectHeader(e){let t;do{const e=await this.tokenizer.readToken(B);switch(P("header GUID=%s",e.objectId.str),e.objectId.str){case f.guid.str:{const t=await this.tokenizer.readToken(new f(e));this.metadata.setFormat("duration",Number(t.playDuration/BigInt(1e3))/1e4-Number(t.preroll)/1e3),this.metadata.setFormat("bitrate",t.maximumBitrate);break}case j.guid.str:{const t=await this.tokenizer.readToken(new j(e));this.metadata.setFormat("container","ASF/".concat(t.streamType));break}case h.guid.str:{const e=await this.tokenizer.readToken(new h);await this.parseExtensionObject(e.extensionDataSize);break}case U.guid.str:t=await this.tokenizer.readToken(new U(e)),await this.addTags(t);break;case S.guid.str:t=await this.tokenizer.readToken(new S(e)),await this.addTags(t);break;case c.CodecListObject.str:{const e=await O(this.tokenizer);e.forEach(e=>{this.metadata.addStreamInfo({type:e.type.videoCodec?r.S.video:r.S.audio,codecName:e.codecName})});const t=e.filter(e=>e.type.audioCodec).map(e=>e.codecName).join("/");this.metadata.setFormat("codec",t);break}case c.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(e.objectSize-B.len);break;case c.PaddingObject.str:P("Padding: %s bytes",e.objectSize-B.len),await this.tokenizer.ignore(e.objectSize-B.len);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: ".concat(e.objectId.str)),P("Ignore ASF-Object-GUID: %s",e.objectId.str),await this.tokenizer.readToken(new F(e))}}while(--e)}async addTags(e){await Promise.all(e.map(e=>{let{id:t,value:n}=e;return this.metadata.addTag("asf",t,n)}))}async parseExtensionObject(e){do{const t=await this.tokenizer.readToken(B),n=t.objectSize-B.len;switch(t.objectId.str){case y.guid.str:await this.tokenizer.readToken(new y(t));break;case x.guid.str:{const e=await this.tokenizer.readToken(new x(t));await this.addTags(e);break}case N.guid.str:{const e=await this.tokenizer.readToken(new N(t));await this.addTags(e);break}case c.PaddingObject.str:case c.CompatibilityObject.str:case c.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(n);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: ".concat(t.objectId.str)),await this.tokenizer.readToken(new F(t))}e-=t.objectSize}while(e>0)}}}}]);