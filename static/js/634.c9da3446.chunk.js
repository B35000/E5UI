"use strict";(self.webpackChunkold_e5=self.webpackChunkold_e5||[]).push([[634],{9634:(e,a,t)=>{t.d(a,{S:()=>u});var s=t(26784),r=t(36854),i=t(9382),n=t(56110),c=t(79900),o=t(16669);const d=i("music-metadata:id3v2:frame-parser"),l="latin1";function parseGenreCode(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?c.jR[Number.parseInt(e)]:void 0}class h{constructor(e,a){this.major=e,this.warningCollector=a}readData(e,a,t){if(0===e.length)return void this.warningCollector.addWarning("id3v2.".concat(this.major," header has empty tag type=").concat(a));const{encoding:i,bom:c}=n.YF.get(e,0),o=e.length;let m=0,u=[];const p=h.getNullTerminatorLength(i);let f;switch(d("Parsing tag type=".concat(a,", encoding=").concat(i,", bom=").concat(c)),"TXXX"!==a&&"T"===a[0]?"T*":a){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let t;try{t=r.sc(e.slice(1),i).replace(/\x00+$/,"")}catch(T){if(T instanceof Error){this.warningCollector.addWarning("id3v2.".concat(this.major," type=").concat(a," header has invalid string value: ").concat(T.message));break}throw T}switch(a){case"TMCL":case"TIPL":case"IPLS":u=h.functionList(this.splitValue(a,t));break;case"TRK":case"TRCK":case"TPOS":u=t;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":u=this.splitValue(a,t);break;case"TCO":case"TCON":u=this.splitValue(a,t).map((e=>function(e){const a=[];let t,s="";for(const r of e)if("string"===typeof t)if("("===r&&""===t)s+="(",t=void 0;else if(")"===r){""!==s&&(a.push(s),s="");const e=parseGenreCode(t);e&&a.push(e),t=void 0}else t+=r;else"("===r?t="":s+=r;return s&&(0===a.length&&s.match(/^\d*$/)&&(s=parseGenreCode(s)),s&&a.push(s)),a}(e))).reduce(((e,a)=>e.concat(a)),[]);break;case"PCS":case"PCST":u=this.major>=4?this.splitValue(a,t):[t],u=Array.isArray(u)&&""===u[0]?1:0;break;default:u=this.major>=4?this.splitValue(a,t):[t]}break}case"TXXX":{const t=h.readIdentifierAndData(e,m+1,o,i);u={description:t.id,text:this.splitValue(a,r.sc(t.data,i).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(t){const a={};switch(m+=1,this.major){case 2:a.format=r.sc(e.slice(m,m+3),"latin1"),m+=3;break;case 3:case 4:f=r.sX(e,m,o,l),a.format=r.sc(e.slice(m,f),l),m=f+1;break;default:throw function(e){throw new g("Unexpected majorVer: ".concat(e))}(this.major)}a.format=h.fixPictureMimeType(a.format),a.type=n.n5[e[m]],m+=1,f=r.sX(e,m,o,i),a.description=r.sc(e.slice(m,f),i),m=f+p,a.data=e.slice(m,o),u=a}break;case"CNT":case"PCNT":u=s.UINT32_BE.get(e,0);break;case"SYLT":{const a=n.aY.get(e,0);m+=n.aY.len;const t={descriptor:"",language:a.language,contentType:a.contentType,timeStampFormat:a.timeStampFormat,syncText:[]};let r=!1;for(;m<o;){const i=h.readNullTerminatedString(e.subarray(m),a.encoding);if(m+=i.len,r){const a=s.UINT32_BE.get(e,m);m+=s.UINT32_BE.len,t.syncText.push({text:i.text,timestamp:a})}else t.descriptor=i.text,r=!0}u=t;break}case"ULT":case"USLT":case"COM":case"COMM":{const a=n.Jp.get(e,m);m+=n.Jp.len;const t=h.readNullTerminatedString(e.subarray(m),a.encoding);m+=t.len;const s=h.readNullTerminatedString(e.subarray(m),a.encoding);u={language:a.language,descriptor:t.text,text:s.text};break}case"UFID":{const a=h.readIdentifierAndData(e,m,o,l);u={owner_identifier:a.id,identifier:a.data};break}case"PRIV":{const a=h.readIdentifierAndData(e,m,o,l);u={owner_identifier:a.id,data:a.data};break}case"POPM":{f=r.sX(e,m,o,l);const a=r.sc(e.slice(m,f),l);m=f+1;const t=o-m;u={email:a,rating:s.UINT8.get(e,m),counter:t>=5?s.UINT32_BE.get(e,m+1):void 0};break}case"GEOB":{f=r.sX(e,m+1,o,i);const a=r.sc(e.slice(m+1,f),l);m=f+1,f=r.sX(e,m,o-m,i);const t=r.sc(e.slice(m,f),l);m=f+1,f=r.sX(e,m,o-m,i);u={type:a,filename:t,description:r.sc(e.slice(m,f),l),data:e.slice(m+1,o)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":f=r.sX(e,m+1,o,i),u=r.sc(e.slice(m,f),l);break;case"WXXX":{f=r.sX(e,m+1,o,i);const a=r.sc(e.slice(m+1,f),i);m=f+("utf-16le"===i?2:1),u={description:a,url:r.sc(e.slice(m,o),l)};break}case"WFD":case"WFED":u=r.sc(e.slice(m+1,r.sX(e,m+1,o,i)),i);break;case"MCDI":u=e.slice(0,o);break;default:d("Warning: unsupported id3v2-tag-type: ".concat(a))}return u}static readNullTerminatedString(e,a){let t=a.bom?2:0;const s=r.sX(e,t,e.length,a.encoding),i=e.slice(t,s);return t="utf-16le"===a.encoding?s+2:s+1,{text:r.sc(i,a.encoding),len:t}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const a={};for(let t=0;t+1<e.length;t+=2){const s=e[t+1].split(",");a[e[t]]=a[e[t]]?a[e[t]].concat(s):s}return a}splitValue(e,a){let t;return this.major<4?(t=a.split(/\x00/g),t.length>1?this.warningCollector.addWarning("ID3v2.".concat(this.major," ").concat(e," uses non standard null-separator.")):t=a.split(/\//g)):t=a.split(/\x00/g),h.trimArray(t)}static trimArray(e){return e.map((e=>e.replace(/\x00+$/,"").trim()))}static readIdentifierAndData(e,a,t,s){const i=r.sX(e,a,t,s),n=r.sc(e.slice(a,i),s);return a=i+h.getNullTerminatorLength(s),{id:n,data:e.slice(a,t)}}static getNullTerminatorLength(e){return"utf-16le"===e?2:1}}class g extends((0,o.fO)("id3v2")){}const m=new TextDecoder("ascii");class u{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let a=0,t=0;for(;a<e.length-1;)a!==t&&(e[t]=e[a]),a+=255===e[a]&&0===e[a+1]?2:1,t++;return a<e.length&&(e[t++]=e[a]),e.slice(0,t)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw ID3v2Parser_makeUnexpectedMajorVersionError(e)}}static readFrameFlags(e){return{status:{tag_alter_preservation:r.mh(e,0,6),file_alter_preservation:r.mh(e,0,5),read_only:r.mh(e,0,4)},format:{grouping_identity:r.mh(e,1,7),compression:r.mh(e,1,3),encryption:r.mh(e,1,2),unsynchronisation:r.mh(e,1,1),data_length_indicator:r.mh(e,1,0)}}}static readFrameData(e,a,t,s,r){var i,n;const c=new h(t,r);switch(t){case 2:return c.readData(e,a.id,s);case 3:case 4:return null!==(i=a.flags)&&void 0!==i&&i.format.unsynchronisation&&(e=u.removeUnsyncBytes(e)),null!==(n=a.flags)&&void 0!==n&&n.format.data_length_indicator&&(e=e.slice(4,e.length)),c.readData(e,a.id,s);default:throw ID3v2Parser_makeUnexpectedMajorVersionError(t)}}static makeDescriptionTagName(e,a){return e+(a?":".concat(a):"")}async parse(e,a,t){this.tokenizer=a,this.metadata=e,this.options=t;const s=await this.tokenizer.readToken(n.yW);if("ID3"!==s.fileIdentifier)throw new g("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=s,this.headerType="ID3v2.".concat(s.version.major),s.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(s.size)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(n.nl),a=e.size-n.nl.len;return a>0?this.parseExtendedHeaderData(a,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,a){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-a)}async parseId3Data(e){const a=await this.tokenizer.readToken(new s.Uint8ArrayType(e));for(const t of this.parseMetadata(a))if("TXXX"===t.id)t.value&&await this.handleTag(t,t.value.text,(()=>t.value.description));else await(Array.isArray(t.value)?Promise.all(t.value.map((e=>this.addTag(t.id,e)))):this.addTag(t.id,t.value))}async handleTag(e,a,t){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e;await Promise.all(a.map((a=>this.addTag(u.makeDescriptionTagName(e.id,t(a)),s(a)))))}async addTag(e,a){await this.metadata.addTag(this.headerType,e,a)}parseMetadata(e){let a=0;const t=[];for(;a!==e.length;){const s=u.getFrameHeaderLength(this.id3Header.version.major);if(a+s>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const r=e.slice(a,a+s);a+=s;const i=this.readFrameHeader(r,this.id3Header.version.major),n=e.slice(a,a+i.length);a+=i.length;const c=u.readFrameData(n,i,this.id3Header.version.major,!this.options.skipCovers,this.metadata);c&&t.push({id:i.id,value:c})}return t}readFrameHeader(e,a){let t;switch(a){case 2:t={id:m.decode(e.slice(0,3)),length:s.UINT24_BE.get(e,3)},t.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning("Invalid ID3v2.".concat(this.id3Header.version.major," frame-header-ID: ").concat(t.id));break;case 3:case 4:t={id:m.decode(e.slice(0,4)),length:(4===a?n.St:s.UINT32_BE).get(e,4),flags:u.readFrameFlags(e.slice(8,10))},t.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning("Invalid ID3v2.".concat(this.id3Header.version.major," frame-header-ID: ").concat(t.id));break;default:throw ID3v2Parser_makeUnexpectedMajorVersionError(a)}return t}}function ID3v2Parser_makeUnexpectedMajorVersionError(e){throw new g("Unexpected majorVer: ".concat(e))}}}]);