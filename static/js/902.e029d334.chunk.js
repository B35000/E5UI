"use strict";(self.webpackChunkold_e5=self.webpackChunkold_e5||[]).push([[902],{96902:(e,t,a)=>{a.r(t),a.d(t,{FlacParser:()=>f});var s=a(26784),i=a(9382),r=a(36854),n=a(66347),o=a(92610),c=a(76124),h=a(32832),l=a(72619),d=a(16669);const m=i("music-metadata:parser:FLAC");class p extends((0,d.fO)("FLAC")){}var g;!function(e){e[e.STREAMINFO=0]="STREAMINFO",e[e.PADDING=1]="PADDING",e[e.APPLICATION=2]="APPLICATION",e[e.SEEKTABLE=3]="SEEKTABLE",e[e.VORBIS_COMMENT=4]="VORBIS_COMMENT",e[e.CUESHEET=5]="CUESHEET",e[e.PICTURE=6]="PICTURE"}(g||(g={}));class f extends o.k{constructor(){super(...arguments),this.vorbisParser=new h.J(this.metadata,this.options),this.padding=0}async postId3v2Parse(){if("fLaC"!==(await this.tokenizer.readToken(c.e)).toString())throw new p("Invalid FLAC preamble");let e;do{e=await this.tokenizer.readToken(u),await this.parseDataBlock(e)}while(!e.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}async parseDataBlock(e){switch(m("blockHeader type=".concat(e.type,", length=").concat(e.length)),e.type){case g.STREAMINFO:return this.parseBlockStreamInfo(e.length);case g.PADDING:this.padding+=e.length;break;case g.APPLICATION:case g.SEEKTABLE:break;case g.VORBIS_COMMENT:return this.parseComment(e.length);case g.CUESHEET:break;case g.PICTURE:return void await this.parsePicture(e.length);default:this.metadata.addWarning("Unknown block type: ".concat(e.type))}return this.tokenizer.ignore(e.length).then()}async parseBlockStreamInfo(e){if(e!==T.len)throw new p("Unexpected block-stream-info length");const t=await this.tokenizer.readToken(T);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",t.channels),this.metadata.setFormat("bitsPerSample",t.bitsPerSample),this.metadata.setFormat("sampleRate",t.sampleRate),t.totalSamples>0&&this.metadata.setFormat("duration",t.totalSamples/t.sampleRate)}async parseComment(e){const t=await this.tokenizer.readToken(new s.Uint8ArrayType(e)),a=new l.Y(t,0);a.readStringUtf8();const i=a.readInt32(),r=new Array(i);for(let s=0;s<i;s++)r[s]=a.parseUserComment();await Promise.all(r.map((e=>this.vorbisParser.addTag(e.key,e.value))))}async parsePicture(e){if(this.options.skipCovers)return this.tokenizer.ignore(e);const t=await this.tokenizer.readToken(new n.xu(e));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",t)}}const u={len:4,get:(e,t)=>({lastBlock:r.mh(e,t,7),type:r.f5(e,t,1,7),length:s.UINT24_BE.get(e,t+1)})},T={len:34,get:(e,t)=>({minimumBlockSize:s.UINT16_BE.get(e,t),maximumBlockSize:s.UINT16_BE.get(e,t+2)/1e3,minimumFrameSize:s.UINT24_BE.get(e,t+4),maximumFrameSize:s.UINT24_BE.get(e,t+7),sampleRate:s.UINT24_BE.get(e,t+10)>>4,channels:r.f5(e,t+12,4,3)+1,bitsPerSample:r.f5(e,t+12,7,5)+1,totalSamples:r.f5(e,t+13,4,36),fileMD5:new s.Uint8ArrayType(16).get(e,t+18)})}},92610:(e,t,a)=>{a.d(t,{k:()=>l});var s=a(88359),i=a(9382),r=a(56110),n=a(9634),o=a(79900),c=a(81705);const h=i("music-metadata:parser:ID3");class l extends c.s{constructor(){super(...arguments),this.id3parser=new n.S}static async startsWithID3v2Header(e){return"ID3"===(await e.peekToken(r.yW)).fileIdentifier}async parse(){try{await this.parseID3v2()}catch(e){if(!(e instanceof s.d1))throw e;h("End-of-stream")}}finalize(){}async parseID3v2(){if(await this.tryReadId3v2Headers(),h("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny())this.finalize();else{const e=new o.Bn(this.metadata,this.tokenizer,this.options);await e.parse(),this.finalize()}}async tryReadId3v2Headers(){if("ID3"===(await this.tokenizer.peekToken(r.yW)).fileIdentifier)return h("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}},66347:(e,t,a)=>{a.d(t,{Sl:()=>o,Z:()=>n,xu:()=>r});var s=a(26784),i=a(56110);class r{static fromBase64(e){return r.fromBuffer(Uint8Array.from(atob(e),(e=>e.charCodeAt(0))))}static fromBuffer(e){return new r(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const a=i.n5[s.UINT32_BE.get(e,t)];t+=4;const r=s.UINT32_BE.get(e,t);t+=4;const n=new s.StringType(r,"utf-8").get(e,t);t+=r;const o=s.UINT32_BE.get(e,t);t+=4;const c=new s.StringType(o,"utf-8").get(e,t);t+=o;const h=s.UINT32_BE.get(e,t);t+=4;const l=s.UINT32_BE.get(e,t);t+=4;const d=s.UINT32_BE.get(e,t);t+=4;const m=s.UINT32_BE.get(e,t);t+=4;const p=s.UINT32_BE.get(e,t);t+=4;return{type:a,format:n,description:c,width:h,height:l,colour_depth:d,indexed_color:m,data:Uint8Array.from(e.slice(t,t+p))}}}const n={len:7,get:(e,t)=>({packetType:s.UINT8.get(e,t),vorbis:new s.StringType(6,"ascii").get(e,t+1)})},o={len:23,get:(e,t)=>({version:s.UINT32_LE.get(e,t+0),channelMode:s.UINT8.get(e,t+4),sampleRate:s.UINT32_LE.get(e,t+5),bitrateMax:s.UINT32_LE.get(e,t+9),bitrateNominal:s.UINT32_LE.get(e,t+13),bitrateMin:s.UINT32_LE.get(e,t+17)})}},72619:(e,t,a)=>{a.d(t,{Y:()=>i});var s=a(26784);class i{constructor(e,t){this.data=e,this.offset=t}readInt32(){const e=s.UINT32_LE.get(this.data,this.offset);return this.offset+=4,e}readStringUtf8(){const e=this.readInt32(),t=new TextDecoder("utf-8").decode(this.data.subarray(this.offset,this.offset+e));return this.offset+=e,t}parseUserComment(){const e=this.offset,t=this.readStringUtf8(),a=t.indexOf("=");return{key:t.slice(0,a).toUpperCase(),value:t.slice(a+1),len:this.offset-e}}}},32832:(e,t,a)=>{a.d(t,{J:()=>l});var s=a(26784),i=a(9382),r=a(72619),n=a(66347),o=a(16669);const c=i("music-metadata:parser:ogg:vorbis1");class h extends((0,o.fO)("Vorbis")){}class l{constructor(e,t){this.metadata=e,this.options=t,this.pageSegments=[]}async parsePage(e,t){if(e.headerType.firstPage)this.parseFirstPage(e,t);else{if(e.headerType.continued){if(0===this.pageSegments.length)throw new h("Cannot continue on previous page");this.pageSegments.push(t)}if(e.headerType.lastPage||!e.headerType.continued){if(this.pageSegments.length>0){const e=l.mergeUint8Arrays(this.pageSegments);await this.parseFullPage(e)}this.pageSegments=e.headerType.lastPage?[]:[t]}}e.headerType.lastPage&&this.calculateDuration(e)}static mergeUint8Arrays(e){const t=e.reduce(((e,t)=>e+t.length),0),a=new Uint8Array(t);return e.forEach(((e,t,s)=>{const i=s.slice(0,t).reduce(((e,t)=>e+t.length),0);a.set(e,i)})),a}async flush(){await this.parseFullPage(l.mergeUint8Arrays(this.pageSegments))}async parseUserComment(e,t){const a=new r.Y(e,t).parseUserComment();return await this.addTag(a.key,a.value),a.len}async addTag(e,t){if("METADATA_BLOCK_PICTURE"===e&&"string"===typeof t){if(this.options.skipCovers)return void c("Ignore picture");t=n.xu.fromBase64(t),c("Push picture: id=".concat(e,", format=").concat(t.format))}else c("Push tag: id=".concat(e,", value=").concat(t));await this.metadata.addTag("vorbis",e,t)}calculateDuration(e){this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",e.absoluteGranulePosition),this.metadata.setFormat("duration",e.absoluteGranulePosition/this.metadata.format.sampleRate))}parseFirstPage(e,t){this.metadata.setFormat("codec","Vorbis I"),c("Parse first page");const a=n.Z.get(t,0);if("vorbis"!==a.vorbis)throw new h("Metadata does not look like Vorbis");if(1!==a.packetType)throw new h("First Ogg page should be type 1: the identification header");{const e=n.Sl.get(t,n.Z.len);this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("bitrate",e.bitrateNominal),this.metadata.setFormat("numberOfChannels",e.channelMode),c("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",e.sampleRate,e.bitrateNominal,e.channelMode)}}async parseFullPage(e){const t=n.Z.get(e,0);if(c("Parse full page: type=%s, byteLength=%s",t.packetType,e.byteLength),3===t.packetType)return this.parseUserCommentList(e,n.Z.len)}async parseUserCommentList(e,t){const a=s.UINT32_LE.get(e,t);t+=4,t+=a;let i=s.UINT32_LE.get(e,t);for(t+=4;i-- >0;)t+=await this.parseUserComment(e,t)}}}}]);